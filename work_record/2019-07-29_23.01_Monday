# This document records daily work and other log infomation.

2019/7/29 23.01 Monday

.WORK_PLAN
    1.继续学习ospf和isis
    
.STUDY_PLAN
    1.<8.30-8.50><unix环境编程.PDF> by my phone. 
    2.<12.30-13.00>看看自制操作系统这本书，在深入理解一下操作系统都是怎么工作的。
    3.<13.00-14.00>sleep
    4.<15.00-18.00>学习强国文章、视频学习。
    5.<18.00-20.30>根据work完成情况，未完成则继续work。完成的话，vlan，还可以看一下L3的脚本，看看启动顺序到底是怎么样的，这个捋一下。
    6.<21.30-22.00>小崽子视频
    7.<22.30-23.00>在家记录一天的completion和summary，以及新一天plan，提交至github。
    8.<23.10-24.00>如果想玩的话，LOL和虎牙。不想玩就洗洗上床玩会儿手机。也没啥电影看。
    9.<24.00-01.00>玩或者睡觉。
    除学习任务，其他时间点可能不太会变，晚上时间可能不准，但是7必须要做，其他娱乐可自由安排一些。
    
.WORK_COMPLETION
    1.今天主要是开会，然后验证了静态路由配置之后，进行三层转发。
    
.STUDY_COMPLETION
    1.又看了锁的知识点，关于进程调用close，会清除该进程的该文件的锁。
    2.没有看
    3.完成
    4.完成
    5.继续工作，验证了静态路由配置的三层转发，和rip的开启。
    6.完成
    7.完成    
    
.SUMMARY
    今天主要是用那个小黑盒子和交换机连接，之后pc1.1.1.60->1.1.1.2小盒子3.3.3.22->3.3.3.1交换机2.2.2.1->pc2.2.2.99，这么个过程ping，报文从1.1.1.60到2.2.2.99，按道理小盒子上应该有一条路由：去往2.2.2.0/24的报文，下一跳ip为3.3.3.1，下一跳接口enp2s0。直连路由去往1.1.1.60/32的报文。下一跳接口为enp4s0。交换机中需要有直连路由去往2.2.2.99/32的报文，下一跳接口为port2。反方向：交换机中去往1.1.1.0/24的报文，下一跳ip为3.3.3.22，下一跳接口为port3。小盒子中直连路由去往1.1.1.60/32的报文，下一跳接口为enp4s0。
    发现的问题：1.1.1.60可以ping通2.2.2.99，但是pingbutong交换机网关3.3.3.1和2.2.2.1。
    原因：交换机接收到小盒子路由上来的1.1.1.60的ICMP报文，但是交换机的linux内核中并没有去往1.1.1.0/24的路由。为什么没有呢，是因为，我们的设备实现的是在收到arp之后，才会建立一条去往发送arp的源ip的路由，在本例子中就是，会建立3.3.3.22/32这条路由，因为1.1.1.60的arp报文是不会直接到达3.3.3.1这个接口上的。并且内核中的路由表和芯片中的路由表，作用是有点不一样的，我们发现从2.2.2.99的ICMP报文也能到达1.1.1.60，是因为我们在芯片中配置了去往1.1.1.0/24的静态路由，报文是经过芯片的路由表进行转发出去的，而直接用1.1.1.60ping3.3.3.1，这个报文上交换机的cpu了，由内核处理这个报文，内核查找自己的路由表发现，没有去往1.1.1.0/24的路由，那么，内核发送了一条arp广播报文，请求1.1.1.60的mac地址，这条报文从收到icmp报文的3端口重新广播出去，之后到达了小盒子的enp2s0，但是enp2s0和snp4s不在一个广播域，因此，这条广播报文无法到达1.1.1.60。。这么分析应该是对的。
    下次再要配置什么东西，就要先画图和分析，不要上来就配置，这样只会越弄越乱。
    
    
    
    
    
    
    
    
    
    
